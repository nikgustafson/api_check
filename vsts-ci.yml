# Docker image
# Build a Docker image to run, deploy, or push to a container registry.
# Add steps that use Docker Compose, tag images, push to a registry, run an image, and more:
# https://docs.microsoft.com/vsts/pipelines/languages/docker

jobs:
- job: 'Test'
  steps:
  - script: pytest panoptes/runScript.py
    displayName: 'Running Smoke Tests'

- job: 'Docker'

  variables:
    imageName: 'kreeher/panoptes:$(build.buildId)'

  steps:
  - script: docker build panoptes -t panoptes
    displayName: 'docker build'
  - script: docker tag panoptes kreeher/panoptes
    displayName: 'docker tag'
  - script: docker login -u $(docker-user) --password-stdin $(docker-pass) 
  - script: docker push kreeher/panoptes
    displayName: 'docker push'
